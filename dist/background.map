{"version":3,"sources":["utils.js","background.js"],"names":["makeExtensionLogger","ext","mod","log","args","console","apply","undefined","join","err","onError","e","makeLogger","bind","makeGetHostname","parser","document","createElement","getHostname","url","href","hostname","noop","xor","arr","val","arrClone","slice","index","indexOf","splice","concat","getActiveTabDomain","Promise","resolve","browser","tabs","query","active","currentWindow","windowType","map","tab","util","recordBlocked","domain","storage","sync","get","then","res","blocked","push","set","all","fetch","text","userblocklist","split","blocklist","list","filter","Boolean","webRequest","onBeforeRequest","addListener","request","disabled","trim","length","cancel","urls","catch"],"mappings":"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","file":"background.map","sourceRoot":"..","sourcesContent":["const makeExtensionLogger = (ext = '', mod = '') => {\n  const log = (...args) =>\n    console.log.apply(undefined, [[ext, mod].join('-'), ...args]);\n  const err = (...args) => log(`Error: `, args);\n  const onError = e => err(e);\n\n  return {\n    log,\n    err,\n    onError\n  };\n};\n\nexport const makeLogger = makeExtensionLogger.bind(undefined, 'DDG');\n\nconst log = makeLogger('UTL');\n\nconst makeGetHostname = () => {\n  let parser = document.createElement('a');\n  const getHostname = url => {\n    parser.href = url;\n    return parser.hostname;\n  };\n  return getHostname;\n};\n\nexport const getHostname = makeGetHostname();\n\nexport const noop = () => undefined;\n\nexport const xor = (arr, val) => {\n  const arrClone = arr.slice(0);\n  const index = arrClone.indexOf(val);\n  if (index >= 0) {\n    arrClone.splice(index, 1);\n    return arrClone;\n  }\n  return arrClone.concat([val]);\n};\n\nexport function getActiveTabDomain() {\n  return new Promise(resolve => {\n    browser.tabs.query(\n      {\n        active: true,\n        currentWindow: true,\n        windowType: 'normal'\n      },\n      tabs => {\n        const [url] = tabs.map(tab => tab.url);\n        resolve(getHostname(url));\n      }\n    );\n  });\n}\n\nconst util = {\n  xor,\n  noop,\n  makeLogger,\n  getHostname,\n  getActiveTabDomain\n};\n\nexport { util as default };\n","import { makeLogger, getHostname, noop, getActiveTabDomain } from './utils';\nconst { log, onError } = makeLogger('BKG');\n\nconst recordBlocked = (domain, hostname) => {\n  browser.storage.sync\n    .get('blocked')\n    .then(res => res.blocked)\n    .then(blocked => {\n      if (typeof blocked[domain] === 'undefined') {\n        blocked[domain] = [];\n      }\n      blocked[domain].push(hostname);\n      browser.storage.sync\n        .set({\n          blocked\n        })\n        .then(noop, onError);\n    });\n};\n\nPromise.all([\n  fetch('./../BLOCKLIST').then(res => res.text()),\n  browser.storage.sync\n    .get('userblocklist')\n    .then(res => (res.userblocklist ? res.userblocklist.split('\\n') : []))\n])\n  .then(([blocklist, userblocklist]) => {\n    const list = blocklist\n      .split('\\n')\n      .concat(userblocklist)\n      .filter(Boolean);\n    const handleBeforeRequest = request => {\n      const hostname = getHostname(request.url);\n      Promise.all([\n        getActiveTabDomain(),\n        browser.storage.sync.get('disabled').then(res => res.disabled)\n      ]).then(([domain, disabled]) => {\n        if (disabled.indexOf(domain) >= 0) {\n          return;\n        }\n        if (hostname.trim().length > 0 && list.indexOf(hostname) >= 0) {\n          log(`BLOCKED: ${hostname}`);\n          recordBlocked(domain, hostname);\n          return {\n            cancel: true\n          };\n        }\n      });\n    };\n\n    browser.webRequest.onBeforeRequest.addListener(\n      handleBeforeRequest,\n      {\n        urls: ['<all_urls>']\n      },\n      ['blocking']\n    );\n  })\n  .catch(onError);\n"]}